<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HowstheWeather</title>
    <link rel="stylesheet" href="design.css">
</head>
<body>
    <header>
        <div class="logo">HowsTheWeather</div>
        <div class="search-bar">
            <input type="text" placeholder="ê²€ìƒ‰">
            <button>ê²€ìƒ‰</button>
        </div>
        <div class="location">
            <span class="location-icon">ğŸ“</span>
            <p id="location">ìœ„ì¹˜ ì •ë³´ ì—†ìŒ</p>
            <button class="btn-location" onclick="getLocation()">ìœ„ì¹˜ ì •ë³´ì™€ ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸°</button>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="#">About us</a></li>
            <li><a href="#">Contact</a></li>
        </ul>
    </nav>

    <main>
        <div class="current-weather">
            <h2>í˜„ì¬ ë‚ ì”¨</h2>
            <p id="current-weather">ë‚ ì”¨ ì •ë³´ ì—†ìŒ</p>
        </div>

        <div class="comment-section">
            <h2>ì‹¤ì‹œê°„ ëŒ“ê¸€</h2>
            <ul id="live-comments">
                <li>No comments yet</li>
            </ul>
            <textarea id="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            <button onclick="submitComment()">ëŒ“ê¸€ ë“±ë¡</button>
        </div>

        <div class="forecast">
            <div class="hourly-forecast">
                <h2>ì‹œê°„ë³„ ì˜ˆë³´</h2>
                <div id="hourly-weather">ì‹œê°„ë³„ ì˜ˆë³´ ì •ë³´ ì—†ìŒ</div>
            </div>

            <div class="weekly-forecast">
                <h2>ì£¼ê°„ ì˜ˆë³´</h2>
                <div id="forecast-weather">ì£¼ê°„ ì˜ˆë³´ ì •ë³´ ì—†ìŒ</div>
            </div>
        </div>
    </main>

    <footer>
        <p>Â© 2024 ë‚ ì”¨ ì˜ˆë³´. All rights reserved.</p>
    </footer>

    <script>
        const weatherApiKey = '3ad08992386749b7956717e6b2538ba7'; // Weatherbit API í‚¤
        const geocodingApiKey = 'e0ae11f71ea14c5bbf91ba8e8c17ee95'; // OpenCage Geocoding API í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”.
        const serviceKey = 'xRFh/7MePsQJHhC6N30b2YiwwanKNDkhDlioe9ZLDYH/isyTZrarXJ+7RpY5UrOyy0mRpaR7tGO4OOpCsXfm2g=='; // ë°œê¸‰ë°›ì€ ì„œë¹„ìŠ¤ í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”.

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                document.getElementById("location").innerHTML = "ì´ ë¸Œë¼ìš°ì €ëŠ” Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            }
        }

        function showPosition(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            getCityName(latitude, longitude);
            getCurrentWeather(latitude, longitude);
            getHourlyWeather(latitude, longitude);
            getForecastWeather(latitude, longitude);
        }

        function getCityName(latitude, longitude) {
            const geocodingUrl = `https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=${geocodingApiKey}&language=ko&pretty=1`;

            fetch(geocodingUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Geocoding API error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Geocoding data:', data);
                    const locationInfo = data.results[0].components;
                    const city = locationInfo.city || locationInfo.town || locationInfo.village || "Unknown city";
                    const country = locationInfo.country;
                    document.getElementById("location").innerHTML = `ìœ„ì¹˜: ${country} ${city}`;
                })
                .catch(error => {
                    console.error('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    document.getElementById("location").innerHTML = "ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                });
        }

        function getCurrentWeather(latitude, longitude) {
            const weatherUrl = `https://api.weatherbit.io/v2.0/current?lat=${latitude}&lon=${longitude}&key=${weatherApiKey}&lang=kr&units=M`;

            fetch(weatherUrl)
                .then(response => {
                    console.log('Fetch response:', response);
                    if (!response.ok) {
                        throw new Error(`Weather API error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Weather data:', data);
                    const temperature = data.data[0].temp;
                    const weatherDescription = data.data[0].weather.description;
                    document.getElementById("current-weather").innerHTML = `í˜„ì¬ ì˜¨ë„: ${temperature}Â°C<br>ë‚ ì”¨: ${weatherDescription}`;
                })
                .catch(error => {
                    console.error('ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    document.getElementById("current-weather").innerHTML = "ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                });
        }
        function getHourlyWeather(latitude, longitude, serviceKey) {
    const today = new Date();
    const yyyy = today.getFullYear().toString();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const baseDate = `${yyyy}${mm}${dd}`;
    const baseTimes = ['0200', '0500', '0800', '1100', '1400', '1700', '2000', '2300'];

    const promises = baseTimes.map(baseTime => {
        const hourlyWeatherUrl = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${serviceKey}&numOfRows=12&pageNo=1&dataType=JSON&base_date=${baseDate}&base_time=${baseTime}&nx=${longitude}&ny=${latitude}`;
        
        return fetch(hourlyWeatherUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Hourly Weather API error! status: ${response.status}`);
                }
                return response.json();
            });
    });

    Promise.all(promises)
        .then(responses => {
            let hourlyHtml = '';
            responses.forEach(data => {
                const items = data.response.body.items.item;
                items.forEach(item => {
                    hourlyHtml += `
                        <div>
                            <p>ë°œí‘œì¼ì: ${item.baseDate}</p>
                            <p>ë°œí‘œì‹œê°: ${item.baseTime}</p>
                            <p>ì˜ˆë³´ì¼ì: ${item.fcstDate}</p>
                            <p>ì˜ˆë³´ì‹œê°: ${item.fcstTime}</p>
                            <p>ìë£Œêµ¬ë¶„ë¬¸ì: ${item.category}</p>
                            <p>ì˜ˆë³´ ê°’: ${item.fcstValue}</p>
                            <p>ì¢Œí‘œ (X, Y): (${item.nx}, ${item.ny})</p>
                            <hr>
                        </div>
                    `;
                });
            });
            document.getElementById("hourly-weather").innerHTML = hourlyHtml;
        })
        .catch(error => {
            console.error('ì‹œê°„ë³„ ì˜ˆë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            document.getElementById("hourly-weather").innerHTML = "ì‹œê°„ë³„ ì˜ˆë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        });
}

        function getForecastWeather(latitude, longitude) {
            const forecastUrl = `https://api.weatherbit.io/v2.0/forecast/daily?lat=${latitude}&lon=${longitude}&key=${weatherApiKey}&lang=kr&units=M&days=7`;

            fetch(forecastUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Weather API error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Forecast data:', data);
                    const forecastWeather = data.data;
                    let forecastHtml = '<ul>';
                    forecastWeather.forEach(day => {
                        const date = new Date(day.datetime).toLocaleDateString();
                        const temperature = day.temp;
                        const description = day.weather.description;
                        forecastHtml += `<li>${date}: ${temperature}Â°C, ${description}</li>`;
                    });
                    forecastHtml += '</ul>';
                    document.getElementById("forecast-weather").innerHTML = forecastHtml;
                })
                .catch(error => {
                    console.error('ì£¼ê°„ ì˜ˆë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    document.getElementById("forecast-weather").innerHTML = "ì£¼ê°„ ì˜ˆë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                });
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    document.getElementById("location").innerHTML = "ì‚¬ìš©ìê°€ ìœ„ì¹˜ ì •ë³´ ì œê³µì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    document.getElementById("location").innerHTML = "ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                    break;
                case error.TIMEOUT:
                    document.getElementById("location").innerHTML = "ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.";
                    break;
                case error.UNKNOWN_ERROR:
                    document.getElementById("location").innerHTML = "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                    break;
            }
        }

        function submitComment() {
            const commentInput = document.getElementById("comment-input");
            const commentText = commentInput.value.trim();
            if (commentText !== "") {
                const commentList = document.getElementById("live-comments");
                const newComment = document.createElement("li");
                newComment.textContent = commentText;
                commentList.appendChild(newComment);
                commentInput.value = "";
            }
        }
    </script>
</body>
</html>
